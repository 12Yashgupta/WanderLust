<% layout("/layouts/boilerplate") -%>
<style>
     #filters{
      display: flex;
      flex-wrap: wrap;
      align-items: center;
     }
     .filter{
      text-align: center;
      margin-right: 1.5rem;
      margin-top: 2rem;
      opacity: 0.7;
     }
     .filter:hover{
      opacity: 1;
      cursor: pointer;
     }
     .filter p{
      font-size: 0.8 rem;
     }
     .tax-toggle{
      border: 1px solid black;
      border-radius: 1rem;
      height: 3.25rem;
      padding: 1rem;
      margin-left: 3rem;
      display: flex;
      align-items: center;
     }
     .form-check-input{
      cursor: pointer;
     }
     .tax-info{
      display: none;
     }
</style>
<body>
    <div id="filters">
            <div class="filter">
              <a href="/listings/catagory/Trending" style="text-decoration: none; color: black;">
              <div> <i class="fa-solid fa-fire"></i></div>
              <p>Trending</p>
              </a>
            </div>
            <div class="filter">
              <a href="/listings/catagory/Rooms" style="text-decoration: none; ">
                <div><i class="fa-solid fa-bed"></i></div>
                <p>Rooms</p>
              </a>
           </div>
           <div class="filter">
            <a href="/listings/catagory/Iconic_Cities" style="text-decoration: none; color: black;">
            <div><i class="fa-solid fa-mountain-city"></i></div>
            <p>Iconic Cities</p>
            </a>
           </div>
         <div class="filter">
          <a href="/listings/catagory/Mountains" style="text-decoration: none;">
          <div><i class="fa-solid fa-mountain"></i></div>
          <p>Mountains</p>
          </a>
         </div>
       <div class="filter">
        <a href="/listings/catagory/Campings" style="text-decoration: none; color: black;">
          <div><i class="fa-solid fa-campground"></i></div>
          <p>Campings</p>
        </a>
       </div>
       <div class="filter">
        <a href="/listings/catagory/Farms" style="text-decoration: none;">
        <div><i class="fa-solid fa-cow"></i></div>
        <p>Farms</p>
        </a>
       </div>

            <div class="filter">
              <a href="/listings/catagory/Castles" style="text-decoration: none;color: black;">
               <div><i class="fa-brands fa-fort-awesome"></i></div>
               <p>Castles</p>
              </a>
            </div>

            <div class="filter">
              <a href="/listings/catagory/Artic" style="text-decoration: none;">
              <div><i class="fa-solid fa-snowflake"></i></div>
              <p>Arctic</p>
              </a>
           </div>
            <div class="filter">
              <a href="/listings/catagory/Pools" style="text-decoration: none; color: black;">
              <div><i class="fa-solid fa-person-swimming"></i></div>
              <p>Amazing Pools</p>
              </a>
           </div>
           <div class="tax-toggle ">
            <div class="form-check-reverse form-switch">
              <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
              <label class="form-check-label" for="flexSwitchCheckDefault">Display total after taxes</label>
            </div>
           </div>
    </div>
     
    <!-- Modal -->
<div class="modal modal-lg fade" id="staticBackdrop" data-bs-backdrop="static"
data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered">
    <form id="selectionForm" method="get" action="/listings" class="modal-content">
        <div class="modal-header">
            <h1 class="modal-title fs-5" id="staticBackdropLabel">Filters</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" style="padding: 1rem 3rem;">
            <div class="m-2">
                <h5>Price Rage</h5>
                <p style="font-size: 0.9rem;">Total prices for 5 nights before taxes</p>
                <div class="price-range p-3">
                    <input class="form-control" value="1000" type="number" min="1000" name="minPrice" id="minPrice">
                    <span class="text-secondary">To</span>
                    <input class="form-control" value="2200000" type="number" max="2200000"
                    name="maxPrice" id="maxPrice">
                </div>
            </div>
           
<div class="m-2">
                <h5>Types of place</h5>
                <p style="font-size: 0.9rem;">Search rooms, entire homes or any type of place</p>
                <div class="category-of-place p-2">
                    <div class="row row-cols-lg-6 row-cols-md-4 row-cols-sm-4">
                        <label class="filter-image col text-dark">
                            <div><img src="/img/trending.jpg" alt="" /></div>
                            <p>Trending</p>
                            <input type="checkbox" class="m-0 opt" name="category" value="Trending">
                        </label>
                        <label class="filter-image col text-dark">
                            <div><img src="/img/casas.jpg" alt="" /></div>
                            <p>Casas</p>
                            <input class="m-0 opt" value="Casas" type="checkbox">
                        </label>
                      ....
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-outline-primary">Apply</button>
        </div>
    </form>
</div>
</div>

     
    <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1">
        <%  for(let list of allListings){  %>
            <a href="/listings/<%=list._id%>" class="listing-link">
                <div class="card col listing-card" >
                    <img src="<%=list.image.url%>" class="card-img-top" alt="listing-image" style="height:20rem ">
                    <div class="card-img-overlay"></div>
                    <div class="card-body">
                      <p class="card-text"><b> <%=list.title%></b> <br> &#8377; <%=list.price.toLocaleString("en-In")%> /night  
                      <i class="tax-info">&nbsp; +18% GST</i></p>
                    </div>
                  </div>
            </a>
            <% } %>
    </div>
    <script>
        let taxSwitch=document.getElementById("flexSwitchCheckDefault");
        taxSwitch.addEventListener("click",()=>{
         let tax_info=document.getElementsByClassName("tax-info");
         console.log(tax_info);
         for(tax of tax_info)
         {
          if(tax.style.display!="inline")
          tax.style.display="inline";
         else
         tax.style.display="none";
         }
        }
      );
     
     
    let opt = document.querySelectorAll('.opt');
    opt.forEach((ele) => {
        ele.addEventListener("change", function () {
            if (this.checked == true)
                this.style.display = "block"
            else
                this.style.display = "none"
        })
    })
    document.getElementById('selectionForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const form = e.target;
        const selectedCheckboxes = form.querySelectorAll('input[type="checkbox"]:checked');
        const selectedValues = Array.from(selectedCheckboxes).map(checkbox => checkbox.value);

        // Create a query string with the selected categories
        const params = new URLSearchParams();
        selectedValues.forEach(value => params.append('category', value));

        // Get the price range values
        const minPrice = form.querySelector('#minPrice').value;
        const maxPrice = form.querySelector('#maxPrice').value;
        if (minPrice !== '') params.append('minPrice', minPrice);
        if (maxPrice !== '') params.append('maxPrice', maxPrice);

        // Redirect to the /listings route with the selected values as query parameters
        window.location.href = `/listings?${params.toString()}`;
    });
    </script>
</body>
